/**
 * TiddlyBit - v0.0.6
 * A tiddly JavaScript library for constructing, parsing and serializing Bitcoin scripts.
 * https://github.com/libitx/tiddlybit#readme
 * Copyright Â© 2020 libitx. MIT License
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).TiddlyBit={})}(this,(function(t){"use strict";var e=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){!function(t){var e="undefined"!=typeof Uint8Array?Uint8Array:Array,n="+".charCodeAt(0),r="/".charCodeAt(0),o="0".charCodeAt(0),f="a".charCodeAt(0),i="A".charCodeAt(0),u="-".charCodeAt(0),a="_".charCodeAt(0);function O(t){var e=t.charCodeAt(0);return e===n||e===u?62:e===r||e===a?63:e<o?-1:e<o+10?e-o+26+26:e<i+26?e-i:e<f+26?e-f+26:void 0}t.toByteArray=function(t){var n,r,o,f,i,u;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var a=t.length;i="="===t.charAt(a-2)?2:"="===t.charAt(a-1)?1:0,u=new e(3*t.length/4-i),o=i>0?t.length-4:t.length;var P=0;function c(t){u[P++]=t}for(n=0,r=0;n<o;n+=4,r+=3)c((16711680&(f=O(t.charAt(n))<<18|O(t.charAt(n+1))<<12|O(t.charAt(n+2))<<6|O(t.charAt(n+3))))>>16),c((65280&f)>>8),c(255&f);return 2===i?c(255&(f=O(t.charAt(n))<<2|O(t.charAt(n+1))>>4)):1===i&&(c((f=O(t.charAt(n))<<10|O(t.charAt(n+1))<<4|O(t.charAt(n+2))>>2)>>8&255),c(255&f)),u},t.fromByteArray=function(t){var e,n,r,o,f=t.length%3,i="";function u(t){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)}for(e=0,r=t.length-f;e<r;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],i+=u((o=n)>>18&63)+u(o>>12&63)+u(o>>6&63)+u(63&o);switch(f){case 1:i+=u((n=t[t.length-1])>>2),i+=u(n<<4&63),i+="==";break;case 2:i+=u((n=(t[t.length-2]<<8)+t[t.length-1])>>10),i+=u(n>>4&63),i+=u(n<<2&63),i+="="}return i}}(e)})),n=function(t,e){if(Array.isArray(t))return new Uint8Array(t);return r[e||"utf8"](t)},r={hex:function(t){for(var e=t.length/2,n=new Uint8Array(e),r="",o=0,f=t.length;o<f;++o)r+=t.charAt(o),o>0&&o%2==1&&(n[o>>>1]=parseInt(r,16),r="");return n},utf8:function(t){for(var e,n=[],r=0,i=t.length;r<i;++r)!1!==(e=f(t,r))&&(e<128?n[n.length]=e:o(n,e));return new Uint8Array(n)},base64:function(t){return new Uint8Array(e.toByteArray(t))}};function o(t,e){var n,r,o,f=e,i=0;do{++i}while(f>>>=1);for(r|=[0,0,192,224,240,248,252][n=0|Math.ceil((i-1)/5)],i=7-(o=[0,0,3,4,5,6,7][n])+6*(n-1);i;)r|=+!!(e&1<<i)<<7-o,++o%8==0&&(t[t.length]=r,r=128,o=2),--i;o&&(r|=+!!(1&e)<<7-o,t[t.length]=r)}function f(t,e){e=e||0;var n,r,o=t.charCodeAt(e);if(55296<=o&&o<=56319){if(n=t.charCodeAt(e+1),r=o,isNaN(n))throw new Error("High surrogate not followed by low surrogate");return 1024*(r-55296)+(n-56320)+65536}return!(56320<=o&&o<=57343)&&o}var i=function(t,e,n){n=void 0===n?t.length:n;var r,o,f=0,i=0;a.length=u.length=0;for(;f<t.length;)o=t[f],!i&&128&o?(r=h(o),i+=r,r<8&&(a[a.length]=o&c[6-r])):i?(a[a.length]=o&c[6],!--i&&a.length&&(u[u.length]=O(s(a)),a.length=0)):u[u.length]=O(o),++f;a.length&&!i&&(u[u.length]=O(s(a)),a.length=0);return u.join("")},u=[],a=[],O=String.fromCharCode,P=[64,32,16,8,4,2,1],c=[0,1,3,7,15,31,63,127];function h(t){for(var e=0;e<7&&t&P[e];++e);return e}function s(t){for(var e=0,n=0,r=t.length;n<r;++n)e|=t[n]<<6*(r-n-1);return e}var l=function(t,e){return _[e||"utf8"](t)},_={hex:function(t){for(var e,n="",r=0,o=t.length;r<o;++r)e=t[r],n+=((240&e)>>>4).toString(16),n+=(15&e).toString(16);return n},utf8:function(t){return i(t)},base64:function(t){return e.fromByteArray(t)}};var y=function(t,e,n){return t.subarray(e||0,n||t.length)};var g=function(t,e){if(!t.length)return new Uint8Array(0);var n=void 0!==e?e:function(t){for(var e=0,n=0,r=t.length;n<r;++n)e+=t[n].byteLength;return e}(t),r=new Uint8Array(n),o=t[0],f=o.length,i=0,u=0,a=0;for(;a<n;)u!==f?r[a++]=o[u++]:(u=0,++i,o=t[i],f=o&&o.length);return r};var E=function(t,e,n,r,o){if(n=arguments.length<3?0:n,r=arguments.length<4?0:r,(o=arguments.length<5?t.length:o)===r)return;if(0===e.length||0===t.length)return;o>t.length&&(o=t.length);e.length-n<o-r&&(o=e.length-n+r);if(t.buffer!==e.buffer)return b(t,e,n,r,o);return v(t,e,n,r,o)},A=[].slice;function b(t,e,n,r,o){for(var f=o-r+n,i=n,u=r;i<f;++i,++u)e[i]=t[u]}function v(t,e,n,r,o){for(var f=o+r,i=new Uint8Array(A.call(t,r,f)),u=0;r<f;++r,++u)e[n++]=i[u]}var I,U,d=I={};U="undefined"==typeof WeakMap?null:new WeakMap,I.get=U?function(t){var e=U.get(t.buffer);e||U.set(t.buffer,e=new DataView(t.buffer,0));return e}:function(t){return new DataView(t.buffer,0)};var p={readUInt8:function(t,e){return t[e]},readInt8:function(t,e){var n=t[e];return n<128?n:n-256},readUInt16LE:function(t,e){return d.get(t).getUint16(e+t.byteOffset,!0)},readUInt32LE:function(t,e){return d.get(t).getUint32(e+t.byteOffset,!0)},readInt16LE:function(t,e){return d.get(t).getInt16(e+t.byteOffset,!0)},readInt32LE:function(t,e){return d.get(t).getInt32(e+t.byteOffset,!0)},readFloatLE:function(t,e){return d.get(t).getFloat32(e+t.byteOffset,!0)},readDoubleLE:function(t,e){return d.get(t).getFloat64(e+t.byteOffset,!0)},readUInt16BE:function(t,e){return d.get(t).getUint16(e+t.byteOffset,!1)},readUInt32BE:function(t,e){return d.get(t).getUint32(e+t.byteOffset,!1)},readInt16BE:function(t,e){return d.get(t).getInt16(e+t.byteOffset,!1)},readInt32BE:function(t,e){return d.get(t).getInt32(e+t.byteOffset,!1)},readFloatBE:function(t,e){return d.get(t).getFloat32(e+t.byteOffset,!1)},readDoubleBE:function(t,e){return d.get(t).getFloat64(e+t.byteOffset,!1)}};var w={writeUInt8:function(t,e,n){return t[n]=e},writeInt8:function(t,e,n){return t[n]=e<0?e+256:e},writeUInt16LE:function(t,e,n){return d.get(t).setUint16(n+t.byteOffset,e,!0)},writeUInt32LE:function(t,e,n){return d.get(t).setUint32(n+t.byteOffset,e,!0)},writeInt16LE:function(t,e,n){return d.get(t).setInt16(n+t.byteOffset,e,!0)},writeInt32LE:function(t,e,n){return d.get(t).setInt32(n+t.byteOffset,e,!0)},writeFloatLE:function(t,e,n){return d.get(t).setFloat32(n+t.byteOffset,e,!0)},writeDoubleLE:function(t,e,n){return d.get(t).setFloat64(n+t.byteOffset,e,!0)},writeUInt16BE:function(t,e,n){return d.get(t).setUint16(n+t.byteOffset,e,!1)},writeUInt32BE:function(t,e,n){return d.get(t).setUint32(n+t.byteOffset,e,!1)},writeInt16BE:function(t,e,n){return d.get(t).setInt16(n+t.byteOffset,e,!1)},writeInt32BE:function(t,e,n){return d.get(t).setInt32(n+t.byteOffset,e,!1)},writeFloatBE:function(t,e,n){return d.get(t).setFloat32(n+t.byteOffset,e,!1)},writeDoubleBE:function(t,e,n){return d.get(t).setFloat64(n+t.byteOffset,e,!1)}};var S={},N=S;function L(t,e){for(var n in t)e[n]=t[n]}function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}S.from=n,S.to=l,S.is=function(t){return t instanceof Uint8Array},S.subarray=y,S.join=g,S.copy=E,S.create=function(t){return new Uint8Array(t)},L(p,S),L(w,S);var R={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SPLIT:127,OP_NUM2BIN:128,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_CHECKLOCKTIMEVERIFY:177,OP_CHECKSEQUENCEVERIFY:178,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255,inverse:{}};Object.keys(R).forEach((function(t){if(-1!==t.indexOf("OP_")){var e=R[t];R.inverse[e]=t}}));var OpCode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.op=t.toUpperCase(),this.byte=R[this.op],this.isValid=!!this.op&&Number.isInteger(this.byte),Object.freeze(this),!this.isValid)throw new Error("Invalid OpCode: ".concat(t))};OpCode.prototype.toBuffer=function(){var t=N.create(1);return N.writeUInt8(t,this.byte,0),t},OpCode.prototype.inspect=function(){return"<OpCode ".concat(this.byte," ").concat(this.op,">")},Object.keys(R).forEach((function(t){-1!==t.indexOf("OP_")&&(OpCode[t]=new OpCode(t))})),OpCode.byByte=function(t,e){var n=R.inverse[t];if(n)return OpCode[n];if(e)throw new Error("Invalid OpCode: ".concat(t));return null},Object.freeze(OpCode);var B=OpCode,Script=function(){function Script(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Script),this.chunks=[],this.push(t)}var t,e,n;return t=Script,n=[{key:"fromASM",value:function(t){for(var e=t.split(" "),n=[],r=0;r<e.length;r++){var o=e[r];if("0"===o)n.push(B.OP_0);else if("-1"===o)n.push(B.OP_1NEGATE);else{var f=B[o]||N.from(o,"hex");n.push(f)}}return new this(n)}},{key:"fromBuffer",value:function(t){if(!N.is(t))throw new Error("Data not a valid binary buffer");for(var e=[],n=0;n<t.length;){var r=N.readUInt8(t,n),o=void 0,f=void 0,i=void 0;r>0&&r<76?i=(o=N.subarray(t,n+1,n+r+1)).length+1:76===r?(f=N.readUInt8(t,n+1),i=(o=N.subarray(t,n+2,n+f+2)).length+2):77===r?(f=N.readUInt16LE(t,n+1),i=(o=N.subarray(t,n+3,n+f+3)).length+3):78===r?(f=N.readUInt32LE(t,n+1),i=(o=N.subarray(t,n+5,n+f+5)).length+5):(o=B.byByte(r,!0),i=1),e.push(o),n+=i}return new this(e)}},{key:"fromHex",value:function(t){var e=N.from(t,"hex");return this.fromBuffer(e)}}],(e=[{key:"push",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(t))return this.push([t]);for(var e=0;e<t.length;e++){var n=t[e],r=T(n),o=void 0;N.is(n)||n instanceof B?o=n:Array.isArray(n)&&n.every((function(t){return Number.isInteger(t)&&t<=255}))?o=N.from(n):"string"===r?o=N.from(n):"number"===r&&(o=B.byCode(n)),o&&this.chunks.push(o)}return this}},{key:"toASM",value:function(){for(var t=[],e=0;e<this.chunks.length;e++){var n=this.chunks[e];if(n instanceof B)0===n.byte||n.byte===B.OP_1NEGATE.byte?t.push(n.byte):t.push(n.op);else{var r=N.to(n,"hex");t.push(r)}}return t.join(" ")}},{key:"toBuffer",value:function(){for(var t=N.from(""),e=0;e<this.chunks.length;e++){var n=this.chunks[e];if(n instanceof B)t=N.join([t,n.toBuffer()]);else{var r=n.length,o=void 0;r>0&&r<76?(o=N.create(1),N.writeUInt8(o,r,0),n=N.join([o,n])):r<256?(o=N.create(1),N.writeUInt8(o,r,0),n=N.join([B.OP_PUSHDATA1.toBuffer(),o,n])):r<65536?(o=N.create(2),N.writeUInt16LE(o,r,0),n=N.join([B.OP_PUSHDATA2.toBuffer(),o,n])):r<4294967296&&(o=N.create(4),N.writeUInt32LE(o,r,0),n=N.join([B.OP_PUSHDATA4.toBuffer(),o,n])),t=N.join([t,n])}}return t}},{key:"toHex",value:function(){return N.to(this.toBuffer(),"hex")}}])&&C(t.prototype,e),n&&C(t,n),Script}(),D={binary:N,Script:Script,OpCode:B},H=D.binary,m=D.Script,F=D.OpCode;t.OpCode=F,t.Script=m,t.binary=H,t.default=D,Object.defineProperty(t,"__esModule",{value:!0})}));
